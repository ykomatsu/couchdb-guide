<title>Installing from Source</title>

<meta charset="utf-8">

<link rel="stylesheet" href="../../../style.css">

<link rel="prev" href="windows.html">

<link rel="next" href="json.html">

<script src="../../../script.js"></script>

<h2 id="source">Installing from Source</h2>
<h2 id="source">ソースコードからのインストール</h2>

<p>Generally speaking, you should avoid installing from source. Many operating systems provide package managers that will allow you to download and install CouchDB with a single command. These package managers usually take care of setting things up correctly, handling security, and making sure that the CouchDB database is started and stopped correctly by your system. The first few appendixes showed you how to install CouchDB packages for Unix-like, Mac OS X, and Windows operating systems. If you are unable to follow those instructions, or you need to install by hand for other reasons, this chapter is for you.
<p>一般的に言って、ソースコードからのインストールは避けるべきです。多くのオペレーティングシステムではパッケージマネージャーが提供されていて、それによって1つのコマンドでCouchDBをダウンロードして、インストールすることができるようになっています。これらのパッケージマネージャーは通常、物事を正しくセットアップし、セキュリティを扱い、CouchDBがあなたのシステムによって正しく起動し、停止することを確実にしてくれます。最初の数個の付録に、CouchDBのパッケージをUnix系、Mac OS X、Windowsオペレーティングシステムでインストールする方法が示されています。もし、それらの手順に従うことができなかったり、他の理由で手でインストールする必要があったりするのであれば、この章はあなたのためにあります。

<h3 id="dependencies">Dependencies</h3>
<h3 id="dependencies">依存関係</h3>

<p>To build and install CouchDB, you will need to install a collection of other software that CouchDB depends on. Without this software properly installed on your system, CouchDB will refuse to work. You’ll need to download and install the following:
<p>CouchDBをビルドしてインストールするには、CouchDBの依存する他のソフトウェアのコレクションをインストールする必要があります。これらのソフトウェアがあなたのシステムに適切にインストールされていなければ、CouchDBは動作しません。以下のソフトウェアをダウンロードしてインストールする必要があります。

<ul>

<li><a href="http://erlang.org/">Erlang OTP</a> (&gt;=R12B)</li>

<li><a href="http://icu.sourceforge.net/">ICU</a></li>

<li><a href="http://www.openssl.org/">OpenSSL</a></li>

<li><a href="http://www.mozilla.org/js/spidermonkey/">Mozilla SpiderMonkey</a></li>

<li><a href="http://curl.haxx.se/libcurl/">libcurl</a></li>

<li><a href="http://www.gnu.org/software/make/">GNU Make</a></li>

<li><a href="http://gcc.gnu.org/">GNU Compiler Collection</a></li>

</ul>

<p>It is recommended that you install Erlang OTP R12B-5 or above if possible.
<p>Erlang OTPについては、R12B-5か可能であればそれ以上のバージョンをインストールすることをお勧めします。

<p>Each of these software packages should provide custom installation instructions, either on the website or in the archive you download. If you’re lucky, however, you may be able to use a package manager to install these dependencies.
<p>それぞれのソフトウェアパッケージには、ウェブサイト上かあなたがダウンロードしたアーカイブの中に、それぞれのインストール手順があるはずです。しかしながら、もし運が良ければ、パッケージマネージャーを使ってそれらの依存するパッケージをインストールすることができるかも知れません。

<h4 id="debian">Debian-Based (Including Ubuntu) Systems</h4>
<h4 id="debian">Ubuntuを含むDebianベースのシステム</h4>

<p>You can install the dependencies by running:
<p>次のコマンドを実行して、依存するパッケージをインストールします。

<pre>
apt-get install build-essential erlang libicu-dev libmozjs-dev libcurl4-openssl-dev
</pre>

<p>If you get an error about any of these packages, be sure to check for the current version offered by your distribution. It may be the case that a newer version has been released and the package name has been changed. For example, you can search for the newest ICU package by running:
<p>もし、これらのパッケージのどれかについてエラーが発生するのであれば、使用しているディストリビューションの提供している現在のバージョンを確認してください。新しいバージョンがリリースされていて、パッケージの名前が変わっている場合もあります。例えば、次のコマンドを実行して、最新のICUパッケージを検索します。

<pre>
apt-cache search libicu
</pre>

<p>Select and install the highest version from the list available.
<p>表示されたリストから最新のバージョンを選択し、インストールします。

<h4 id="mac">Mac OS X</h4>

<p>You will need to install the Xcode Tools metapackage by running:
<p>次のコマンドを実行し、Xcode Toolsメタパッケージをインストールする必要があります。

<pre>
open /Applications/Installers/Xcode\ Tools/XcodeTools.mpkg
</pre>

<p>If this is unavailable on your system, you will need to install it from your Mac OS X installation CD. Alternatively, you can <a href="http://developer.apple.com/TOOLS/Xcode/">download a copy</a>.
<p>もし、これがあなたのシステムでは使えないのであれば、あなたのMac OS XインストールCDからインストールする必要があります。代わりに、<a href="http://developer.apple.com/TOOLS/Xcode/">ダウンロードする</a>こともできます。

<p>You can then install the other dependencies using MacPorts by running:
<p>その後、次のコマンドを実行し、MacPortsでその他の依存するパッケージをインストールします。

<pre>
port install icu erlang spidermonkey curl
</pre>

<p>See <a href="mac.html">Appendix B, Installing on Mac OS X</a> for more details.
<p>詳細については、<a href="mac.html">付録B、Mac OS Xへのインストール</a>を参照してください。

<h3 id="installing">Installing</h3>
<h3 id="installing">インストール</h3>

<p>Once you have installed all of the dependencies, you should download a copy of the <a href="http://couchdb.apache.org/downloads.html">CouchDB source</a>. This should give you an archive that you’ll need to unpack. Open up a terminal and change directory to your newly unpacked archive.
<p>すべての依存するパッケージがインストールできたら、<a href="http://couchdb.apache.org/downloads.html">CouchDBのソースコード</a>をダウンロードします。これはアーカイブですので、展開する必要があります。ターミナルを開き、新しい展開されたアーカイブのディレクトリに移動します。

<p>Configure the source by running:
<p>次のコマンドを実行し、ソースコードを設定します。

<pre>
./configure
</pre>

<p>We’re going to be installing CouchDB into <code>/usr/local</code>, which is the default location for user-installed software. A ton of options are available for this command, and you can customize everything from the installation location, such as your home directory, to the location of your Erlang or SpiderMonkey installation.
<p>私たちはCouchDBを<code>/usr/local</code>にインストールしようとしていますが、これはユーザーがインストールするソフトウェアのデフォルトの場所です。このコマンドでは大量のオプションが利用可能であり、インストールする場所をあなたのホームディレクトリにすることから、あなたがErlangやSpiderMonkeyをインストールした場所の指定まで、すべてをカスタマイズすることができます。

<p>To see what’s available, you can run:
<p>何が利用可能かを表示するには、次のコマンドを実行します。

<pre>
./configure --help
</pre>

<p>Generally, you can ignore this step if you didn’t get any errors the first time you ran it. You’ll only need to pass extra options if your setup is a bit weird and the script is having trouble finding one of the dependencies you installed in the last section.
<p>一般的には、最初に実行したときに何もエラーが発生しなかったのであれば、このステップは無視することができます。あなたのセットアップが少し変わっていて、あなたが直前のセクションでインストールした依存するパッケージをスクリプトが探すときに問題が発生した場合にのみ、追加のオプションを設定する必要があります。

<p>If everything was successful, you should see the following message:
<p>もし、すべてが成功したのであれば、次のメッセージが表示されるはずです。

<pre>
You have configured Apache CouchDB, time to relax.
</pre>

<p>Relax.
<p>リラックスしてください。

<p>Build and install the source by running:
<p>次のコマンドを実行して、ソースコードをビルドし、インストールします。

<pre>
make &amp;&amp; sudo make install
</pre>

<p>If you changed the installation location to somewhere temporary, you may not want to use the <code>sudo</code> command here. If you are having problems running <code>make</code>, you may want to try running <code>gmake</code> if it is available on your system. More options can be found by reading the <code>INSTALL</code> file.
<p>もし、インストールする場所を一時的などこかに変更したのであれば、<code>sudo</code>コマンドをここで使う必要はないかも知れません。もし、<code>make</code>の実行中に問題が発生したのであれば、<code>gmake</code>があなたのシステムで利用可能であれば、それを実行する必要があるかも知れません。さらなるオプションについては、<code>INSTALL</code>ファイルを読んでください。

<h3 id="security">Security Considerations</h3>
<h3 id="security">セキュリティに関する考慮事項</h3>

<p>It is not advisable to run the CouchDB server as the super user. If the CouchDB server is compromised by an attacker while it is being run by a super user, the attacker will get super user access to your entire system. That’s not what we want!
<p>CouchDBサーバーをスーパーユーザーで実行することはお勧めできません。もし、スーパーユーザーで実行されているときにCouchDBサーバーが攻撃者によって危険な状態になれば、攻撃者はあなたのシステム全体に対するスーパーユーザのアクセス権限を取得するでしょう。それは私たちが望むことではありません！

<p>We strongly recommend that you create a specific user for CouchDB. This user should have as few privileges on your system as possible, preferably the bare minimum needed to run the CouchDB server, read the configuration files, and write to the data and log directories.
<p>私たちは、CouchDB専用のユーザーを作成することを強くお勧めします。このユーザーの持つあなたのシステムへの権限は出来る限り少なくすべきで、それは設定ファイルの読み込み、データとログのディレクトリへの書き込みといった、CouchDBサーバーが動作するためだけに必要な最低限であることが望ましいといえます。

<p>You can use whatever tool your system provides to create a new <code>couchdb</code> user.
<p>新しい<code>couchdb</code>ユーザーを作成するには、あなたのシステムが提供するどんなツールを使っても構いません。

<p>On many Unix-like systems you can run:
<p>多くのUnix系システムでは、次のコマンドを実行します。

<pre>
adduser --system --home /usr/local/var/lib/couchdb --no-create-home --shell /bin/bash --group --gecos "CouchDB" couchdb
</pre>

<p>Mac OS X provides the standard Accounts option from the System Preferences application, or you can use the Workgroup Manager application, which can be downloaded as part of the <a href="http://www.apple.com/support/downloads/serveradmintools1047.html">Server Admin Tools</a>.
<p>Mac OS Xはシステム設定アプリケーションでアカウントオプションが提供されています。また、<a href="http://www.apple.com/support/downloads/serveradmintools1047.html">サーバ管理ツール</a>の一部としてダウンロードすることができる、ワークグループマネージャを使うこともできます。

<p>You should make sure that the <code>couchdb</code> user has a working login shell. You can test this by logging into a terminal as the <code>couchdb</code> user. You should also make sure to set the home directory to <code>/usr/local/var/lib/couchdb</code>, which is the CouchDB database directory.
<p><code>couchdb</code>ユーザーでログインシェルが動作することを確認してください。ターミナルに<code>couchdb</code>ユーザーとしてログインすることでテストすることができます。また、ホームディレクトリが<code>/usr/local/var/lib/couchdb</code>に設定されていることを確認してください。これはCouchDBのデータベースのディレクトリです。

<p>Change the ownership of the CouchDB directories by running:
<p>次のコマンドを実行して、CouchDBのディレクトリの所有権を変更します。

<pre>
chown -R couchdb:couchdb /usr/local/etc/couchdb
chown -R couchdb:couchdb /usr/local/var/lib/couchdb
chown -R couchdb:couchdb /usr/local/var/log/couchdb
chown -R couchdb:couchdb /usr/local/var/run/couchdb
</pre>

<p>Change the permission of the CouchDB directories by running:
<p>次のコマンドを実行して、CouchDBのディレクトリのパーミッションを変更します。

<pre>
chmod -R 0770 /usr/local/etc/couchdb
chmod -R 0770 /usr/local/var/lib/couchdb
chmod -R 0770 /usr/local/var/log/couchdb
chmod -R 0770 /usr/local/var/run/couchdb
</pre>

<p>This isn’t the final word in securing your CouchDB setup. If you’re deploying CouchDB on the Web, or any place where untrusted parties can access your sever, it behooves you to research the recommended security measures for your operating system and take any additional steps needed. Keep in mind the network security adage that the only way to properly secure a computer system is to unplug it from the network.
<p>これはCouchDBのセットアップを安全にするための最後の言葉ではありません。もし、CouchDBをウェブ上、または信頼できない団体がサーバーにアクセスできるような場所にデプロイするのであれば、使用しているオペレーティングシステムで推奨されているセキュリティ対策を調査し、必要な追加のステップを実行する義務があなたにはあります。コンピューターシステムを適切に保護するたったひとつの方法は、ネットワークから切り離すことだ、というネットワークのセキュリティについての格言を頭に入れておいてください。

<h3 id="manually">Running Manually</h3>
<h3 id="manually">手動での実行</h3>

<p>You can start the CouchDB server by running:
<p>次のコマンドを実行し、CouchDBサーバーを起動します。

<pre>
sudo -i -u couchdb couchdb -b
</pre>

<p>This uses the <code>sudo</code> command to run the <code>couchdb</code> command as the <code>couchdb</code> user.
<p>これは<code>sudo</code>コマンドを使って、<code>couchdb</code>コマンドを<code>couchdb</code>ユーザーで実行します。

<p>When CouchDB starts, it should eventually display the following message:
<p>CouchDBが起動すると、そのうち次のメッセージが表示されます。

<pre>
Apache CouchDB has started, time to relax.
</pre>

<p>Relax.
<p>リラックスしてください。

<p>To check that everything has worked, point your web browser to:
<p>すべてが動作していることを確認するため、ウェブブラウザで次のURLにアクセスします。

<pre>
http://127.0.0.1:5984/_utils/index.html
</pre>

<p>This is Futon, the CouchDB web administration console. We covered the basics of Futon in our early chapters. Once you have it loaded, you should select and run the CouchDB Test Suite from the righthand menu. This will make sure that everything is behaving as expected, and it may save you some serious headaches if things turn out to be a bit wonky.
<p>これは、Futonと呼ばれる、CouchDBのウェブ管理コンソールです。私たちは最初の方の章でFutonの基本を紹介しました。Futonが読み込まれたら、右側のメニューからCouchDBテストスイートを実行します。これは、すべてが期待通りに動作することを確認するもので、何か不安定な部分が判明した場合にあなたを深刻な頭痛から救うかも知れません。

<h3 id="daemon">Running As a Daemon</h3>
<h3 id="daemon">デーモンとしての実行</h3>

<p>Once you’ve got CouchDB running nicely, you’ll probably want to run it as daemon. A daemon is a software application that runs continually in the background, waiting to handle requests. This is how most production database servers run, and you can configure CouchDB to run like this, too.
<p>CouchDBがうまく動作するようになれば、それをデーモンとして実行したくなるでしょう。デーモンとはバックグラウンドで継続的に動作し、リクエストを処理するために待ち受けているソフトウェアアプリケーションです。これはほとんどの本番環境のデータベースサーバーの実行に用いられている方法で、CouchDBもこのように実行できるように設定することができます。

<p>When you run CouchDB as a daemon, it logs to a number of files that you’ll want to clean up from time to time. Letting your log files fill up a disk is a good way to break your server! Some operating systems come with software that does this for you, and it is important for you to research your options and take the necessary steps to make sure that this doesn’t become a problem. CouchDB ships with a <code>logrotate</code> configuration that may be useful.
<p>CouchDBをデーモンとして実行すると、たくさんのファイルにログが記録されるので、あなたは時々それを整理したいと思うでしょう。ログファイルでディスクをいっぱいにするというのは、サーバーを停止させる方法としては十分です！オペレーティングシステムの中には、あなたのためにログの整理をするソフトウェアが付属しているものもありますが、ログを整理する選択肢を調査し、問題が発生していないことを確認するために必要なステップを踏むことは大切なことです。CouchDBには<code>logrotate</code>の設定が付属しています。これが役に立つも知れません。

<h4 id="init">SysV/BSD-Style Systems</h4>
<h4 id="init">SysV・BSDスタイルのシステム</h4>

<p>Depending on your operating system, the <code>couchdb</code> daemon script could be installed into a directory called <code>init.d</code> (for SysV-style systems) or <code>rc.d</code> (for BSD-style systems) under the <code>/usr/local/etc</code> directory. The following examples use <code>[init.d|rc.d]</code> to indicate this choice, and you must replace it with your actual directory before running any of these commands.
<p>使用しているオペレーティングシステムに応じて、<code>/usr/local/etc</code>ディレクトリ以下の、SysVスタイルのシステムでは<code>init.d</code>と呼ばれるディレクトリに、BSDスタイルのシステムでは<code>rc.d</code>と呼ばれるディレクトリに<code>couchdb</code>デーモンスクリプトがインストールされます。以下の例では、そのどちらかを示すために<code>[init.d|rc.d]</code>を用いますので、それらのコマンドを実行する前に、それを実際のディレクトリに置き換える必要があります。

<p>You can start the CouchDB daemon by running:
<p>次のコマンドを実行して、CouchDBデーモンを起動します。

<pre>
sudo /usr/local/etc/[init.d|rc.d]/couchdb start
</pre>

<p>You can stop the CouchDB daemon by running:
<p>次のコマンドを実行して、CouchDBデーモンを停止します。

<pre>
sudo /usr/local/etc/[init.d|rc.d]/couchdb stop
</pre>

<p>You can get the status of the CouchDB daemon by running:
<p>次のコマンドを実行して、CouchDBの状態を取得します。

<pre>
sudo /usr/local/etc/[init.d|rc.d]/couchdb status
</pre>

<p>If you want to configure how the daemon script works, you will find a bunch of options you can edit in the <code>/usr/local/etc/default/couchdb</code> file.
<p>もし、デーモンスクリプトの動作する方法を設定したいのであれば、<code>/usr/local/etc/default/couchdb</code>ファイルにたくさんの編集できるオプションがあります。

<p>If you want to run the script without the <code>sudo</code> command, you will need to remove the <code>COUCHDB_USER</code> setting from this file.
<p>もし、<code>sudo</code>コマンドなしでスクリプトを実行したいのであれば、このファイルから<code>COUCHDB_USER</code>の設定を削除する必要があります。

<p>Your operating system will probably provide a way to control the CouchDB daemon automatically, starting and stopping it as a system service. To do this, you will need to copy the daemon script into your system <code>/etc/[init.d|rc.d]</code> directory, and run a command such as:

<pre>
sudo update-rc.d couchdb defaults
</pre>

<p>Consult your system documentation for more information.
<p>詳細については、システムドキュメントを参照してください。

<h4 id="launchd">Mac OS X</h4>

<p>You can use the <code>launchd</code> system to control the CouchDB daemon.
<p><code>launchd</code>システムを使って、CouchDBデーモンをコントロールすることができます。

<p>You can load the <code>launchd</code> configuration by running:
<p>次のコマンドを実行して、<code>launchd</code>の設定を読み込みます。

<pre>
sudo launchctl load /usr/local/Library/LaunchDaemons/org.apache.couchdb.plist
</pre>

<p>You can unload the <code>launchd</code> configuration by running:
<p>次のコマンドを実行して、<code>launchd</code>の設定を除去します。

<pre>
sudo launchctl unload /usr/local/Library/LaunchDaemons/org.apache.couchdb.plist
</pre>

<p>You can start the CouchDB daemon by running:
<p>次のコマンドを実行して、CouchDBデーモンを起動します。

<pre>
sudo launchctl start org.apache.couchdb
</pre>

<p>You can stop the CouchDB daemon by running:
<p>次のコマンドを実行して、CouchDBデーモンを停止します。

<pre>
sudo launchctl stop org.apache.couchdb
</pre>

<p>The <code>launchd</code> system can control the CouchDB daemon automatically, starting and stopping it as a system service. To do this, you will need to copy the plist file into your system <code>/Library/LaunchDaemons</code> directory.
<p><code>launchd</code>システムはCouchDBデーモンを自動的にコントロールし、システムサービスとして起動、停止させることができます。これをするには、plistファイルをあなたのシステムの<code>/Library/LaunchDaemons</code>ディレクトリにコピーする必要があります。


<p>Consult the <code>launchd</code> documentation for more information.
<p>詳細については、<code>launchd</code>のドキュメントを参照してください。

<h3 id="troubleshooting">Troubleshooting</h3>
<h3 id="troubleshooting">トラブルシューティング</h3>

<p>Software being software, you can count on something going wrong every now and then. No need to panic; CouchDB has a great community full of people who will be able to answer your questions and help you get started. Here are a few resources to help you on your way:
<p>ソフトウェアはソフトウェアであるため、時々何か問題が起きることがあります。パニックに陥る必要はありません。CouchDBにはあなたの質問に答え、あなたが始めるのを助けてくれる人でいっぱいのすばらしいコミュニティーがあります。ここにあなたの道程に役立ついくつかのリソースを示します。

<ul>

<li>If you’re getting a weird error message, see the <a href="http://wiki.apache.org/couchdb/Error_messages">Error Messages wiki page</a>.</li>
<li>もし、変なエラーメッセージが表示されたのであれば、<a href="http://wiki.apache.org/couchdb/Error_messages">Error Messages wikiページ</a>を参照してください。</li>

<li>For general troubleshooting, try out the <a href="http://wiki.apache.org/couchdb/Troubleshooting">Troubleshooting steps</a>.</li>
<li>一般的なトラブルシューティングには、<a href="http://wiki.apache.org/couchdb/Troubleshooting">Troubleshooting steps</a>を試してみてください。</li>

<li>For other general support, you should visit the <a href="http://couchdb.apache.org/community/lists.html">mailing lists</a>.</li>
<li>その他の一般的なサポートには、<a href="http://couchdb.apache.org/community/lists.html">メーリングリスト</a>を利用すべきです。</li>

</ul>

<p>Don’t forget to use your favorite search engine when diagnosing problems. If you look around a bit, you’re likely to find something. It’s very possible that a bunch of other people have had exactly the same problem as you and a solution has been posted somewhere on the Web. Good luck, and remember to relax!
<p>問題を診断するときには、好きな検索エンジンを使うことを忘れないでください。少し周りを見れば、何かを見付けることができそうです。その他のたくさんの人がまったく同じ問題を抱えていて、ウェブ上のどこかに解決方法が掲載されているという可能性は非常に高いといえます。健闘を祈ります。そして、リラックスすることを忘れないでください！
